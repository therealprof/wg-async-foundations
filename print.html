<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>wg-async-foundations</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="welcome.html"><strong aria-hidden="true">1.</strong> üëãüèΩ Welcome</a></li><li class="chapter-item "><a href="vision.html"><strong aria-hidden="true">2.</strong> üîÆ The vision</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/tenets.html"><strong aria-hidden="true">2.1.</strong> ‚úèÔ∏è Design tenets for async</a></li><li class="chapter-item "><a href="vision/characters.html"><strong aria-hidden="true">2.2.</strong> üôã‚Äç‚ôÄÔ∏è Cast of characters</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/characters/alan.html"><strong aria-hidden="true">2.2.1.</strong> Alan</a></li><li class="chapter-item "><a href="vision/characters/grace.html"><strong aria-hidden="true">2.2.2.</strong> Grace</a></li><li class="chapter-item "><a href="vision/characters/niklaus.html"><strong aria-hidden="true">2.2.3.</strong> Niklaus</a></li><li class="chapter-item "><a href="vision/characters/barbara.html"><strong aria-hidden="true">2.2.4.</strong> Barbara</a></li></ol></li><li class="chapter-item "><a href="vision/applications.html"><strong aria-hidden="true">2.3.</strong> ‚ö° Applications</a></li><li class="chapter-item "><a href="vision/status_quo.html"><strong aria-hidden="true">2.4.</strong> üò± Status quo</a></li><li class="chapter-item "><a href="vision/shiny_future.html"><strong aria-hidden="true">2.5.</strong> ‚ú® Shiny future</a></li><li class="chapter-item "><a href="vision/roadmap.html"><strong aria-hidden="true">2.6.</strong> üìÖ Roadmap for 2021</a></li><li class="chapter-item "><a href="vision/how_to_vision_doc.html"><strong aria-hidden="true">2.7.</strong> ‚ùìHow to vision doc</a></li></ol></li><li class="chapter-item "><a href="triage.html"><strong aria-hidden="true">3.</strong> üîç Triage meetings</a></li><li class="chapter-item "><a href="design_docs.html"><strong aria-hidden="true">4.</strong> üî¨ Design docs</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design_docs/yield_safe.html"><strong aria-hidden="true">4.1.</strong> ‚ö†Ô∏è Yield-safe lint</a></li><li class="chapter-item "><a href="design_docs/stream.html"><strong aria-hidden="true">4.2.</strong> ‚òî Stream trait</a></li><li class="chapter-item "><a href="design_docs/generator_syntax.html"><strong aria-hidden="true">4.3.</strong> ‚ö° Generator syntax</a></li><li class="chapter-item "><a href="design_docs/async_read_write.html"><strong aria-hidden="true">4.4.</strong> üìù AsyncRead, AsyncWrite traits</a></li><li class="chapter-item "><a href="design_docs/async_fn_in_traits.html"><strong aria-hidden="true">4.5.</strong> üß¨ Async fn in traits</a></li><li class="chapter-item "><a href="design_docs/mutex.html"><strong aria-hidden="true">4.6.</strong> üîí Mutex (future-aware)</a></li><li class="chapter-item "><a href="design_docs/channels.html"><strong aria-hidden="true">4.7.</strong> üì∫ Async aware channels</a></li><li class="chapter-item "><a href="design_docs/async_closures.html"><strong aria-hidden="true">4.8.</strong> üì¶ Async closures</a></li><li class="chapter-item "><a href="design_docs/join.html"><strong aria-hidden="true">4.9.</strong> ü§ù Join combinator</a></li><li class="chapter-item "><a href="design_docs/select.html"><strong aria-hidden="true">4.10.</strong> ü§∑‚Äç‚ôÄÔ∏è Select combinator</a></li><li class="chapter-item "><a href="design_docs/sink_trait.html"><strong aria-hidden="true">4.11.</strong> üö∞ Sink trait</a></li><li class="chapter-item "><a href="design_docs/async_main.html"><strong aria-hidden="true">4.12.</strong> üéá Async main</a></li><li class="chapter-item "><a href="design_docs/async_drop.html"><strong aria-hidden="true">4.13.</strong> üóëÔ∏è Async drop</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design_docs/async_lifecycle.html"><strong aria-hidden="true">4.13.1.</strong> ‚ôªÔ∏è Async lifecycle</a></li></ol></li><li class="chapter-item "><a href="design_docs/completion_based_futures.html"><strong aria-hidden="true">4.14.</strong> ‚è≥ Completion-based futures</a></li></ol></li><li class="chapter-item "><a href="conversations.html"><strong aria-hidden="true">5.</strong> üí¨ Conversations</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="conversations/2021-02-12-Twitter-Thread.html"><strong aria-hidden="true">5.1.</strong> üê¶ 2021-02-12 Twitter thread</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">wg-async-foundations</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="-welcome"><a class="header" href="#-welcome">üëãüèΩ Welcome</a></h1>
<p>Welcome to the wg-async-foundations website!</p>
<h2 id="leads"><a class="header" href="#leads">Leads</a></h2>
<p>The leads of this working group are <a href="https://github.com/tmandry">@tmandry</a> and <a href="https://github.com/nikomatsakis">@nikomatsakis</a>. Both of them can be found on <a href="welcome.html#zulip">Zulip</a>.</p>
<h2 id="getting-involved"><a class="header" href="#getting-involved">Getting involved</a></h2>
<p>There is a weekly <a href="./triage.html">triage meeting</a> that takes place in our <a href="welcome.html#zulip">Zulip stream</a>. Feel free to stop by then (or any time!) to introduce yourself. </p>
<p>If you're interested in fixing bugs, though, there is no need to wait for the meeting! <a href="./triage.html#so-you-want-to-fix-a-bug">Take a look at the instructions here.</a></p>
<h2 id="what-is-the-goal-of-this-working-group"><a class="header" href="#what-is-the-goal-of-this-working-group">What is the goal of this working group?</a></h2>
<p>This working group is focused around implementation/design of the ‚Äúfoundations‚Äù for Async I/O. This means that we are focused on designing and implementing extensions to the language, standard library, and other &quot;core&quot; bits of support offered by the Rust organization. We do not directly work on external projects like <a href="https://tokio.rs/">tokio</a>, <a href="https://async.rs/">async-std</a>, <a href="https://github.com/smol-rs/smol/">smol</a>, <a href="https://github.com/akiles/embassy">embassy</a> and so forth, although we definitely discuss ideas and coordinate with them where appropriate.</p>
<h2 id="zulip"><a class="header" href="#zulip">Zulip</a></h2>
<p>We hold discussions on <a href="https://rust-lang.zulipchat.com/#narrow/stream/187312-wg-async-foundations">the <code>#wg-async-foundations</code> stream in Zulip</a></p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Licensed under either of</p>
<ul>
<li>Apache License, Version 2.0 (<a href="LICENSE-APACHE">LICENSE-APACHE</a> or http://www.apache.org/licenses/LICENSE-2.0)</li>
<li>MIT license (<a href="LICENSE-MIT">LICENSE-MIT</a> or http://opensource.org/licenses/MIT)</li>
</ul>
<p>at your option.</p>
<h3 id="contribution"><a class="header" href="#contribution">Contribution</a></h3>
<p>Unless you explicitly state otherwise, any contribution intentionally submitted
for inclusion in this crate by you, as defined in the Apache-2.0 license, shall
be dual licensed as above, without any additional terms or conditions.</p>
<h1 id="-the-vision"><a class="header" href="#-the-vision">üîÆ The vision</a></h1>
<h2 id="what-is-this"><a class="header" href="#what-is-this">What is this</a></h2>
<p>Async-await first [stabilized] in November 2019, and today people are building all kinds of applications using it. We believe Rust can become one of the most popular choices for building distributed systems, ranging from embedded devices to foundational cloud services.</p>
<p>Regardless of their application, we want all developers to love using Async Rust. For that to happen, we need to move Async Rust beyond the &quot;MVP&quot; state it's in today and make it accessible to everyone.</p>
<p>This document is a collaborative effort to build a shared vision for Async Rust. <strong>Our goal is to engage the entire community in a collective act of the imagination:</strong> how can we make the end-to-end experience of using Async I/O not only a pragmatic choice, but a <em>joyful</em> one?</p>
<h2 id="involving-the-whole-community"><a class="header" href="#involving-the-whole-community">Involving the whole community</a></h2>
<p>Building a truly great experience for Async Rust takes more than just <code>async fn</code>. We need to think about the end-to-end experience -- everything from what happens when people first learn Async Rust, to what happens as they are building their application, to what happens after deployment.</p>
<p>The challenge for us is to drive that holistic product experience while retaining the loosely coupled, exploration-oriented ecosystem we have built. Async Rust was intentionally designed not to have a &quot;one size fits all&quot; mindset, and we don't want to change that. But we need a forum where we can coordinate on the overall experience we are all shooting for. That is what this document is for!</p>
<h2 id="the-vision-drives-the-work"><a class="header" href="#the-vision-drives-the-work">The vision drives the work</a></h2>
<p>The vision is not just idle speculation. It is the central document that we use to organize ourselves. When we think about our <a href="./vision/roadmap.html">roadmap</a> for any given year, it is always with the aim of moving us closer to the vision we lay out here.</p>
<h2 id="-under-construction-help-needed-"><a class="header" href="#-under-construction-help-needed-">üöß Under construction! Help needed! üöß</a></h2>
<p>This document is not yet complete! We are actively working on it as part of the working group, and we would like your help! Check out the <a href="./vision/how_to_vision_doc.html">How to vision doc</a> page for more details.</p>
<h1 id="-design-tenets-for-async"><a class="header" href="#-design-tenets-for-async">‚úèÔ∏è Design tenets for async</a></h1>
<table><thead><tr><th>Status</th><th>Owner</th></tr></thead><tbody>
<tr><td>‚ö†Ô∏è Draft ‚ö†Ô∏è</td><td>nikomatsakis</td></tr>
</tbody></table>
<p><strong>Draft status.</strong> These tenets are a first draft. nikomatsakis plans to incorporate feedback and revise them before they are finalized.</p>
<p>The design tenets describe the key principles that drive our work on async. Hopefully, we are able to achieve and honor all of them all of the time. Sometimes, though, they come into conflict, and we have to pick -- in that case, we prefer the tenet earlier in the list.</p>
<ol>
<li><strong>Minimal overhead.</strong> Rust Async I/O performance should compare favourably with any other language. In the extreme case, it should be possible to use async/await without any required allocation, although this is unlikely to be a common case in production systems.</li>
<li><strong>Easy to get started, but able to do anything you want.</strong> We should make it simple to write Async I/O code and get things that work reasonably well, but it should be possible for people to obtain fine-grained control as needed.</li>
<li><strong>Async is like sync, but with blocking points clearly identified.</strong> At the highest level, writing a simple program using asynchronous I/O in Rust should be analogous to writing one that uses synchronous I/O, except that one adds <code>async</code> in front of function declarations and adds <code>.await</code> after each call. We should aim for analogous design between synchronous and asynchronous equivalents. Similarly, streams should be like asynchronous iterators. One should be able to use the same sort of combinators with streams and to iterate over them in analogous ways.</li>
<li><strong>No one true runtime.</strong> We need to be able to hook into existing runtimes in different environments, from embedded environments to runtimes like node.js. Specialized systems need specialized runtimes. </li>
<li><strong>Library ecosystem is key.</strong> We want to have a strong ecosystem of async crates, utilities, and frameworks. This will require mechanisms to write libraries/utilities/frameworks that are generic and interoperable across runtimes.</li>
</ol>
<h2 id="stress-tests"><a class="header" href="#stress-tests">Stress tests</a></h2>
<p>&quot;Stress tests&quot; are important use cases that tend to &quot;stretch&quot; the design. When we are contemplating changes, it's important to look over the stress tests and make sure that they all still work:</p>
<ul>
<li><strong>Single-threaded executors:</strong> Some systems tie each task to a single thread; such tasks should be able to access data that is not <code>Send</code> or <code>Sync</code>, and the executor for those tasks should be able to be fully optimized to avoid atomic accesses, etc.</li>
<li><strong>Multi-threaded executors:</strong> Many systems migrate tasks between threads transparently, and that should be supported as well, though tasks will be required to be <code>Send</code>.</li>
<li><strong>&quot;Bring your own runtime&quot;:</strong> The Rust language itself should not require that you start threads, use epoll, or do any other particular thing.</li>
<li><strong>Zero allocation, single task:</strong> Embedded systems might want to be able to have a single task that is polled to completion and which does no allocation whatsoever.</li>
<li><strong>Multiple runtimes in one process:</strong> Sometimes people have to combine systems, each of which come with their own event loop. We should avoid assuming there is one global event loop in the system. </li>
<li><strong>Non-Rust based runtimes:</strong> Sometimes people want to integrate into event loops from other, non-Rust-based systems.</li>
<li><strong>WebAssembly in the browser:</strong> We want to integrate with WebAssembly.</li>
</ul>
<h1 id="-cast-of-characters"><a class="header" href="#-cast-of-characters">üôã‚Äç‚ôÄÔ∏è Cast of characters</a></h1>
<h2 id="what-is-this-1"><a class="header" href="#what-is-this-1">What is this?</a></h2>
<p>We've created four characters that we use to help drive the &quot;status quo&quot; stories. These four individuals help us to give color to the stories, but of course four people can't cover the full range of people using Async Rust. We've also defined a number of <a href="vision/characters.html#axes">axes</a> that give a more complete description.</p>
<h2 id="the-characters"><a class="header" href="#the-characters">The characters</a></h2>
<ul>
<li><a href="vision/./characters/alan.html">Alan: the full stack developer</a></li>
<li><a href="vision/./characters/grace.html">Grace: the full stack developer</a></li>
<li><a href="vision/./characters/niklaus.html">Niklaus: the developer building generic Rust libraries and frameworks</a></li>
<li><a href="vision/./characters/barbara.html">Barbara: embedded developer doing networking</a></li>
</ul>
<h2 id="axes"><a class="header" href="#axes">Axes</a></h2>
<p>The &quot;axes&quot; are how we categorize and think about the space of people that are using Async Rust. The characters above all represent important points in this &quot;user space&quot;, but sometimes it's useful to have a more complete picture.</p>
<p>This list will probably never be complete! If you don't see yourself in the answers listed here, please feel free to suggest additions. (<a href="vision/./how_to_vision_doc.html#adding-or-adjusting-the-axes-or-set-of-characters">Instructions here.</a>)</p>
<table><thead><tr><th>Question</th><th>Answers</th></tr></thead><tbody>
<tr><td>Programming language background</td><td>JS (node.js, browser)</td></tr>
<tr><td></td><td>Python</td></tr>
<tr><td></td><td>Ruby</td></tr>
<tr><td></td><td>C, C++</td></tr>
<tr><td></td><td>Java, Kotlin</td></tr>
<tr><td></td><td>&quot;Sync&quot; Rust</td></tr>
<tr><td>Overall programming experience</td><td>Beginner</td></tr>
<tr><td></td><td>Intermediate</td></tr>
<tr><td></td><td>Advanced</td></tr>
<tr><td>Async experience</td><td>None</td></tr>
<tr><td></td><td>From JS, C#</td></tr>
<tr><td></td><td>Writing custom state machines in C</td></tr>
<tr><td></td><td>Suffered through the futures 0.1 days üëª</td></tr>
<tr><td>Target application</td><td>too many to list...</td></tr>
<tr><td></td><td>...see <a href="vision/./applications.html">applications</a>!</td></tr>
<tr><td>Role</td><td>Principal engineer, tech lead</td></tr>
<tr><td></td><td>Team member</td></tr>
<tr><td></td><td>One of many things I do at my job</td></tr>
<tr><td></td><td>Maintaining an open source crate on the side</td></tr>
<tr><td></td><td>Hobbyist</td></tr>
</tbody></table>
<h1 id="-cast-of-characters-1"><a class="header" href="#-cast-of-characters-1">üôã‚Äç‚ôÄÔ∏è Cast of characters</a></h1>
<h3 id="alan-the-full-stack-developer"><a class="header" href="#alan-the-full-stack-developer">Alan: the full stack developer</a></h3>
<p>Alan is a &quot;full stack&quot; developer who has been solving problems for customers in many companies. He's used node.js, Ruby-on-Rails, Django, and a couple other frameworks besides. Alan was recently hired at <code>fido.io</code>, a pioneering dog-food delivery business that uses a combination of deep learning and <a href="https://en.wikipedia.org/wiki/Internet_of_things">IoT</a> to select the optimum dog food for your pet's health. Fido has chosen to build their networking stack in Rust. They were already using Rust for their deep learning code and they wanted to keep to a single language. For the time being, their needs are relatively simple. They want to stand up a server that serves up pages and connects to various back-end and cloud services.</p>
<h4 id="-frequently-asked-questions"><a class="header" href="#-frequently-asked-questions">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>How would you describe Alan in terms of the <a href="vision/characters/../characters.html#axes">axes</a>?
<ul>
<li><em>Programming language background:</em> JS, Python, Ruby</li>
<li><em>Overall programming experience:</em> Advanced</li>
<li><em>Async experience:</em> From JS</li>
<li><em>Target application:</em> Web sites</li>
<li><em>Role:</em> Team member</li>
</ul>
</li>
<li>What is most important to Alan about async Rust? Why?
<ul>
<li>Alan prioritizes flexibility and ergonomics. He wants to be able to stand up a site quickly and be able to easily extend it to meet his future needs.</li>
</ul>
</li>
<li>What is least important to Alan about async Rust? Why?
<ul>
<li>Alan is not overly concerned about performance. The site has to be &quot;fast enough&quot; but they're not handling a ton of network traffic at the moment.</li>
</ul>
</li>
<li>What are key parts of Alan's background or story that distinguishes them from the other characters?
<ul>
<li>Alan's background is in dynamic languages like JavaScript, Ruby, and Python. Many of these languages have an async-await feature, but it works differently from Rust in some particulars.</li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-2"><a class="header" href="#-cast-of-characters-2">üôã‚Äç‚ôÄÔ∏è Cast of characters</a></h1>
<h3 id="grace-the-principal-engineer-hacking-on-a-data-storage-service"><a class="header" href="#grace-the-principal-engineer-hacking-on-a-data-storage-service">Grace: the principal engineer hacking on a data storage service</a></h3>
<p>Grace is a principal engineer who has been building high-performance networking systems in Java and C++ for a number of years. She currently works on a distributed data storage service that is used in a lot of the world's largest web properties. This service is implemented in Java, with certain key components written in C++. Grace is currently working on introducing Rust into the system.</p>
<h4 id="-frequently-asked-questions-1"><a class="header" href="#-frequently-asked-questions-1">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>How would you describe Grace in terms of the <a href="vision/characters/../characters.html#axes">axes</a>?
<ul>
<li><em>Programming language background:</em> C(++), Java</li>
<li><em>Overall programming experience:</em> Advanced</li>
<li><em>Async experience:</em> Writing custom state machines in C</li>
<li><em>Target application:</em> High performance server</li>
<li><em>Role:</em> Principal</li>
</ul>
</li>
<li>What is most important to Grace about async Rust? Why?
<ul>
<li>Grace prioritizes performance, correctness, and reliability.</li>
</ul>
</li>
<li>What is least important to Grace about async Rust? Why?
<ul>
<li>XXX this is tricky</li>
</ul>
</li>
<li>What are key parts of Grace's background or story that distinguishes them from the other characters?
<ul>
<li>Grace has been working on network services for years in different languages. She's fairly familiar with existing tools and is often able to cobble together a fix to overcome obstacles.</li>
<li>At the same time, Grace is also accustomed to a certain suite of tools being available. She's used to monitoring her Java services </li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-3"><a class="header" href="#-cast-of-characters-3">üôã‚Äç‚ôÄÔ∏è Cast of characters</a></h1>
<h3 id="niklaus-the-developer-building-generic-rust-libraries-and-frameworks"><a class="header" href="#niklaus-the-developer-building-generic-rust-libraries-and-frameworks">Niklaus: the developer building generic Rust libraries and frameworks</a></h3>
<p>Niklaus is an open source developer building various generic libraries and frameworks. He is hoping to create successful open source projects that are widely used in all sorts of applications and which have a lively community around them. Niklaus is currently working on the following projects:</p>
<ul>
<li><strong>SLOW</strong>, a Rust implementation of a fancy new communications protocol that is gaining in popularity.</li>
<li><strong>Hyperactive</strong>, a Rust web framework meant to make it easy to standup a web server and start serving requests. Probably exactly what Alan wants!</li>
</ul>
<h4 id="-frequently-asked-questions-2"><a class="header" href="#-frequently-asked-questions-2">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>How would you describe Niklaus in terms of the <a href="vision/characters/../characters.html#axes">axes</a>?
<ul>
<li><em>Programming language background:</em> ?</li>
<li><em>Overall programming experience:</em> Intermediate</li>
<li><em>Async experience:</em> ?</li>
<li><em>Target applications:</em> Web frameworks, protocol libraries, middleware</li>
<li><em>Role:</em> Maintaining an open source crate on the side</li>
</ul>
</li>
<li>What is most important to Niklaus about async Rust? Why?
<ul>
<li>Niklaus prioritizes being able to write things across runtimes and avoiding limiting the set of users that can consume his libraries.</li>
<li>In working on SLOW, he cares about high performance, because he knows many people won't use his library unless it can keep up.</li>
<li>For Hyperactive, he cares a lot about convenience.</li>
</ul>
</li>
<li>What is least important to Niklaus about async Rust? Why?
<ul>
<li>XXX</li>
</ul>
</li>
<li>What are key parts of Niklaus's background or story that distinguishes them from the other characters?
<ul>
<li>Niklaus is a hobbyist. He only has slices of time to do development. He wants to use those bits of time profitably and he wants to enjoy it.</li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-4"><a class="header" href="#-cast-of-characters-4">üôã‚Äç‚ôÄÔ∏è Cast of characters</a></h1>
<h3 id="barbara-embedded-developer-doing-networking"><a class="header" href="#barbara-embedded-developer-doing-networking">Barbara: embedded developer doing networking</a></h3>
<p>Barbara is building a sensor grid system using Rust. The sensors communicate wirelessly to relay their results, and Barbara is responsible for the networking component. These sensors are relatively simple devices with limited resources, so she is coding in a <code>#[no_std]</code> environment and is very careful about things like allocation.</p>
<h4 id="-frequently-asked-questions-3"><a class="header" href="#-frequently-asked-questions-3">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>How would you describe Barbara in terms of the <a href="vision/characters/../characters.html#axes">axes</a>?
<ul>
<li><em>Programming language background:</em> C, C++</li>
<li><em>Overall programming experience:</em> Advanced</li>
<li><em>Async experience:</em> Writing custom state machines in C</li>
<li><em>Target applications:</em> Embedded networking</li>
<li><em>Role:</em> Team member</li>
</ul>
</li>
<li>What is most important to Barbara about async Rust? Why?
<ul>
<li>Barbara needs low-level control. She can't use typical tools.</li>
<li>She also cares about portability: few people work in her space, and she would like to be able to use as many tools and libraries as posible.</li>
</ul>
</li>
<li>What is least important to Barbara about async Rust? Why?
<ul>
<li>XXX</li>
</ul>
</li>
<li>What are key parts of Barbara's background or story that distinguishes them from the other characters?
<ul>
<li>Working in embedded.</li>
</ul>
</li>
</ul>
<h1 id="-applications"><a class="header" href="#-applications">‚ö° Applications</a></h1>
<h2 id="what-is-this-2"><a class="header" href="#what-is-this-2">What is this</a></h2>
<p>This section describes the kinds of projects that people build using Async Rust. As you can see, there are quite a few, and we're surely missing some! For each application area, we also have a short description and some frequently asked questions that help to identify what makes this application area special. </p>
<h3 id="dont-find-your-application-here"><a class="header" href="#dont-find-your-application-here">Don't find your application here?</a></h3>
<p>We just started creating this list, and it's obviously very incomplete. We would welcome PRs to flesh it out!</p>
<h2 id="application-areas"><a class="header" href="#application-areas">Application areas</a></h2>
<h3 id="operating-systems"><a class="header" href="#operating-systems">Operating systems</a></h3>
<p>Core system services like filesystems and networking. IPC between various programs and services. Kernel and driver code; waiting on device I/O.</p>
<h4 id="-frequently-asked-questions-4"><a class="header" href="#-frequently-asked-questions-4">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>What separated this application area from the others?
<ul>
<li>Latency profile: Typically 100's-1,000's of ns, uncontended, for IPC</li>
</ul>
</li>
</ul>
<h2 id="brainstorming"><a class="header" href="#brainstorming">Brainstorming</a></h2>
<p>Here is a list of applications we came up with when brainstorming. We'd welcome PRs to convert these into full blown &quot;application area&quot; descriptions!</p>
<ul>
<li>Web site</li>
<li>High performance server</li>
<li>High performance disk I/O</li>
<li>Web framework</li>
<li>Protocol or other leaf libraries (e.g., HTTP, QUIC, Redis, etc)</li>
<li>SDKs for web services</li>
<li>Middleware and other sorts of &quot;wrapper&quot; libraries (e.g., async-compression)</li>
<li>Media streaming</li>
<li>Consumer of web services (e.g., running things on a compute service, storing and retrieving things with a storage service)</li>
<li>Embedded </li>
<li>GUI application</li>
<li>Parallel data processing</li>
<li>Distributed HPC (compute clusters)</li>
<li>Database clients</li>
<li>Database servers</li>
<li>Async runtimes for others to use</li>
<li>Operating systems</li>
<li>More?</li>
</ul>
<h1 id="-status-quo-stories"><a class="header" href="#-status-quo-stories">üò± Status quo stories</a></h1>
<h2 id="what-is-this-3"><a class="header" href="#what-is-this-3">What is this</a></h2>
<p>The &quot;status quo&quot; stories document the experience of using Async Rust today. Each story narrates the challenges encountered by <a href="vision/./characters.html">one of our characters</a> as they try (and typically fail in dramatic fashion) to achieve their goals.</p>
<p>Writing &quot;status quo&quot; stories helps us compensate for the <a href="https://en.wikipedia.org/wiki/Curse_of_knowledge">curse of knowledge</a> -- in particular, the folks working on Async Rust tend to be experts in Async Rust. We've gotten used to the <a href="https://rust-lang.github.io/async-book/07_workarounds/01_chapter.html">workarounds</a> required to be productive, and we know the little tips and tricks that can get you out of a jam. </p>
<p>Writing the &quot;status quo&quot; stories gives us a concrete way to put ourselves in <a href="vision/./characters.html">our characters'</a> shoes. They help us to estimate the cumulative impact all the paper cuts can have on someone still learning their way around. This gives us the data we need to prioritize.</p>
<h3 id="based-on-a-true-story"><a class="header" href="#based-on-a-true-story">Based on a true story</a></h3>
<p>These stories are not made up. They are always based on real-life experiences of actual people. Each story contains a &quot;Frequently Asked Questions&quot; section, and that will include notes the sources used to create the story. In some cases, it may link to notes or summaries in the <a href="vision/../conversations.html">conversations</a> section, though that is not required. The &quot;Frequently Asked Questions&quot; section also contains a summary of what the &quot;morals&quot; of the story are (i.e., what are the key takeaways), along with answers to questions that people have raised along the way.</p>
<h3 id="the-stories-provide-data-we-use-to-prioritize-not-a-prioritization-itself"><a class="header" href="#the-stories-provide-data-we-use-to-prioritize-not-a-prioritization-itself">The stories provide data we use to prioritize, not a prioritization itself</a></h3>
<p><strong>Just because a user story is represented here doesn't mean we're going to be able to fix it right now.</strong> Some of these user stories will indicate more severe problems than others. As we consider the stories, we'll select some subset to try and address; that choice is reflected in the <a href="vision/./roadmap.html">roadmap</a>.</p>
<h3 id="help-wanted"><a class="header" href="#help-wanted">Help wanted!</a></h3>
<p>This is not a static document! There are lots of ways you can help to expand it! Take a look at the <a href="vision/./how_to_vision_doc.html">How to Vision Doc</a> for more details.</p>
<h2 id="alan-has-trouble-getting-started"><a class="header" href="#alan-has-trouble-getting-started">Alan has trouble getting started</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#alan-the-startup-guy-trying-to-stand-up-a-web-stack-quickly">Alan</a></td><td><a href="vision/./shiny_future.html#alan-has-a-blast-standing-up-a-web-server">Alan has a blast standing up a web server</a></td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>At first, <a href="vision/./characters.html#alan-the-startup-guy-trying-to-stand-up-a-web-stack-quickly">Alan</a> can't find docs about how to do async stuff</li>
<li>Alan finds learning Rust challenging enough, learning async at the same time is even harder (<a href="https://twitter.com/richardsabow/status/1345815115745140736">cite</a>)</li>
<li>Alan has trouble picking a runtime, it's kind of overwhelming -- <a href="https://twitter.com/EchoRior/status/1359965313979346944">what if he picks the wrong one?</a></li>
<li>Alan is confused because adding async/await doesn't seem to be getting him concurrency</li>
<li>Alan tries to connect to a database but the docs aren't very comprehensive</li>
<li>Alan doesn't like the web framework he's using, but the one he likes requires a different runtime, and switching between them is a real pain</li>
<li>Alan quits and becomes a <a href="https://www.pbs.org/show/best-joy-painting/">Bob Ross</a> groupy</li>
</ul>
<h4 id="-frequently-asked-questions-5"><a class="header" href="#-frequently-asked-questions-5">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>Many people cite that picking a runtime is a stressful choice.</li>
<li>People want to be able to 'mix and match' the runtime, web framework, and other libraries and have things just work.</li>
<li>Information on async-await is hard to find and not yet well integrated into standard Rust learning materials.</li>
<li>Rust's async model is different from other languages (JavaScript, C#) and that can be confusing.</li>
<li>Learning async Rust is strictly more work than learning sync Rust, which is already harder than we'd like.</li>
<li>The async book as written gives way too many low-level details way too early.</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>Not at all. This is based on a number of sources, including tweets but also personal conversations.</li>
<li>Some sources can be found in the conversations page:
<ul>
<li><a href="vision/../conversations/2021-02-12-Twitter-Thread.html">2021-02-12 Twitter thread</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Why doesn't Alan go to the tutorial for some specific runtime?</strong>
<ul>
<li>It's true that there are a number of excellent tutorials out there, like the one from <a href="https://tokio.rs/tokio/tutorial">tokio</a> and <a href="https://book.async.rs/tutorial/index.html">async-std</a>. Unfortunately, Alan doesn't know about those runtimes yet! Alan wants to learn Rust, so that's where he started.</li>
</ul>
</li>
</ul>
<h2 id="alan-finds-the-experience-of-writing-async-code-is-a-lot-more-painful-than-sync-code"><a class="header" href="#alan-finds-the-experience-of-writing-async-code-is-a-lot-more-painful-than-sync-code">Alan finds the experience of writing async code is a lot more painful than sync code</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#alan-the-startup-guy-trying-to-stand-up-a-web-stack-quickly">Alan</a></td><td>not yet written</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li><a href="vision/./characters.html#alan-the-startup-guy-trying-to-stand-up-a-web-stack-quickly">Alan</a> gets inscrutable backtraces</li>
<li>Alan tries to write a recursive function and gets a weird error</li>
<li>Alan gets confusing diagnostics because of incompatible versions of the futures crate</li>
<li>Alan gets a confusing compiler error about a variable being live across an await point that doesn‚Äôt seem to be live</li>
<li>Bobs gets an error message that exceeds the memory limits in his terminal program, crashes his computer, and forces him to reboot</li>
</ul>
<h4 id="-frequently-asked-questions-6"><a class="header" href="#-frequently-asked-questions-6">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h2 id="grace-tries-to-write-a-stream-and-pin-breaks-her-mind"><a class="header" href="#grace-tries-to-write-a-stream-and-pin-breaks-her-mind">Grace tries to write a stream and pin breaks her mind</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#grace-the-principal-engineer-hacking-on-a-data-storage-service">Grace</a></td><td><a href="vision/./shiny_future.html#grace-discovers-the-joy-of-generators">Grace discovers the joy of generators</a></td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>We need to make this better -- pick some specific problem Grace was trying to solve</li>
<li>She winds up implementing a stream and has to use pin and it's hard</li>
<li>we don‚Äôt currently provide any language support for doing this</li>
<li>so you have to work with pin</li>
<li>it is very confusing and nobody really understands it</li>
<li>she doesn‚Äôt get parallel like she wanted</li>
<li>she switches to a stream of futures </li>
<li>it kind of works but it‚Äôs a pain to maintain and she doesn‚Äôt like fixing bugs in that code
<ul>
<li>she transfers to another team and somebody else deletes the file, starts over, and repeats her experience</li>
</ul>
</li>
</ul>
<h4 id="-frequently-asked-questions-7"><a class="header" href="#-frequently-asked-questions-7">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h2 id="grace-deploys-her-service-and-hits-obstacles"><a class="header" href="#grace-deploys-her-service-and-hits-obstacles">Grace deploys her service and hits obstacles</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#grace-the-principal-engineer-hacking-on-a-data-storage-service">Grace</a></td><td><a href="vision/./shiny_future.html#grace-deploys-her-service-and-is-able-to-fix-problems">Grace deploys her service and is able to fix problems</a></td></tr>
</tbody></table>
<p>When examining metrics for her service in the past, Grace has noticed tail latencies in the P99 that exceed their SLA, and identified GC in the routing layer as the problem. She decides to investigate rewriting the routing service in Rust. A few months of frantic hacking follow:</p>
<p><img src="https://media.giphy.com/media/ule4vhcY1xEKQ/giphy.gif" alt="montage of cats typing" width=200></img></p>
<p>Soon enough, she and her team have a proof of concept working. They run some local stress tests and notice that 5% of requests hang and fail to respond and the client eventually times out. She is unable to reproduce this problem when running one-off requests locally, it only shows up when sending above 200 requests-per-second. </p>
<p>She realizes that she doesn't have any tooling that can give her insight into what's going on. She starts to add lots of logging, attempting to tie log entries to specific connections. Using an operating system tool, she is able to identify the socket addresses for the hung connections, so she also includes the socket addresses in each log message. She can then grep the logs to find those that are associated with the hung connections. Of course, the logs only tell her what the connection managed to do successfully, they don't tell her why it stopped -- so she has to keep going back and adding more logs until she can narrow down the exact call that hangs.</p>
<p>Eventually, she identifies that the last log message is right before calling the HMAC authentication library that is written C, and is synchronous, but only when refreshing the private authentication token from the source of truth. </p>
<h4 id="-frequently-asked-questions-8"><a class="header" href="#-frequently-asked-questions-8">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h2 id="grace-wants-to-use-io-uring"><a class="header" href="#grace-wants-to-use-io-uring">Grace wants to use io-uring</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#grace-the-principal-engineer-hacking-on-a-data-storage-service">Grace</a></td><td>not yet written</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>there are existing crates, which to use?
<ul>
<li><a href="https://github.com/ringbahn/ringbahn">ringbahn</a></li>
<li><a href="https://github.com/DataDog/glommio">glommio</a></li>
<li><a href="https://crates.io/crates/rio">rio</a> -- &quot;but users should beware that use-after-free bugs are still possible without unsafe when using rio.&quot;</li>
<li><a href="https://github.com/tokio-rs/io-uring">tokio-rs/io-uring</a></li>
<li><a href="https://github.com/quininer/ritsu">quininer/ritsu</a></li>
<li>...and probably more</li>
</ul>
</li>
<li>the AsyncRead trait is not a perfect fit</li>
</ul>
<h4 id="-frequently-asked-questions-9"><a class="header" href="#-frequently-asked-questions-9">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h2 id="niklaus-goes-to-write-slow-but-its-annoying"><a class="header" href="#niklaus-goes-to-write-slow-but-its-annoying">Niklaus goes to write SLOW but it‚Äôs annoying</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#niklaus-the-developer-building-generic-rust-libraries-and-frameworks">Niklaus</a></td><td>not yet written</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>async fns in traits maybe come into this story?</li>
<li>to make it work across many runtimes he has to juggle a lot of feature gates </li>
<li>the AsyncRead trait is in the futures crate, but he can‚Äôt tell how stable that crate is ‚Äî can he rely on it in his public interface? Can he call that 1.0?
<ul>
<li>futures crate makes a breaking change, is he screwed?</li>
</ul>
</li>
<li>he has to copy and paste a bunch of random utilities that everyone seems to use but which aren‚Äôt defined in a shared crate that has a stable version
<ul>
<li>xxx some of them are in futures??</li>
</ul>
</li>
<li>maybe he wants to target WASM?</li>
</ul>
<h4 id="-frequently-asked-questions-10"><a class="header" href="#-frequently-asked-questions-10">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h2 id="niklaus-builds-his-web-framework"><a class="header" href="#niklaus-builds-his-web-framework">Niklaus builds his web framework</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#niklaus-the-developer-building-generic-rust-libraries-and-frameworks">Niklaus</a></td><td>not yet written</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>He is frustrated by lack of async trait support</li>
<li>He uses the <code>async-trait</code> procedural macro but it feels weird to have that in a public, stable API.</li>
<li>As with the SLOW library, he would to make it independent of a specific runtime, but that's very difficult</li>
</ul>
<h4 id="-frequently-asked-questions-11"><a class="header" href="#-frequently-asked-questions-11">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h2 id="barbara-tries-to-use-the-embedded-runtime"><a class="header" href="#barbara-tries-to-use-the-embedded-runtime">Barbara tries to use the embedded runtime</a></h2>
<table><thead><tr><th>Character</th><th>Shiny Future</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#barbara-embedded-developer-doing-networking">Barbara</a></td><td>not yet written</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>She doesn‚Äôt want to use allocation and <code>dyn Trait</code> but async fns in traits are not available on stable rust</li>
<li>She is not wanting to use nightly</li>
</ul>
<h4 id="-frequently-asked-questions-12"><a class="header" href="#-frequently-asked-questions-12">ü§î Frequently Asked Questions</a></h4>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
<li><strong>Are you just making this stuff up?</strong>
<ul>
<li>(Cite important sources here; feel free to add files into the conversations folder for more details)</li>
</ul>
</li>
</ul>
<h1 id="-shiny-future-where-we-want-to-get-to"><a class="header" href="#-shiny-future-where-we-want-to-get-to">‚ú® Shiny future: Where we want to get to</a></h1>
<h2 id="what-it-this"><a class="header" href="#what-it-this">What it this</a></h2>
<p>The &quot;shiny future&quot; is here to tell you what we are trying to build over the next 2-3 years. That is, it presents our &quot;best guess&quot; as to what will look like a few years from now. When describing specific features, it also embeds links to <a href="vision/../design_notes.html">design notes</a> that describe the constraints and general plans around that feature.</p>
<h3 id="think-big----too-big-if-you-have-to"><a class="header" href="#think-big----too-big-if-you-have-to">Think big -- too big, if you have to</a></h3>
<p>You'll notice that the ideas in this document are <strong>maximalist and ambitious</strong>. They stake out an opinionated position on how the ergonomics of Async I/O should feel. This position may not, in truth, be attainable, and for sure there will be changes along the way. Sometimes the realities of how computers actually work may prevent us from doing all that we'd like to. That's ok. This is a dream and a goal.</p>
<p>We fully expect that the designs and narratives described in this document will change as we work towards realizing them. When there are areas of particular uncertainty, we use the Frequently Asked Questions and the design docs to call them out.</p>
<h3 id="-not-time-for-this-yet-"><a class="header" href="#-not-time-for-this-yet-">üõë Not time for this yet üõë</a></h3>
<p>We're not really ready to work on this section yet. We're still focused on writing out the <a href="vision/./status_quo.html">status quo</a>. What you see here are really just placeholders to give you the idea of what this section might look like.</p>
<h2 id="shiny-future-stories"><a class="header" href="#shiny-future-stories">Shiny future stories</a></h2>
<h3 id="alan-has-a-blast-standing-up-a-web-server"><a class="header" href="#alan-has-a-blast-standing-up-a-web-server">Alan has a blast standing up a web server</a></h3>
<table><thead><tr><th>Character</th><th>Status quo</th><th>Assigned To</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#alan-the-startup-guy-trying-to-stand-up-a-web-stack-quickly">Alan</a></td><td><a href="vision/./status_quo.html#alan-has-trouble-getting-started">Alan has trouble getting started</a></td><td>Shane and estebank</td></tr>
</tbody></table>
<p>Outline:</p>
<p>...</p>
<h4 id="-frequently-asked-questions-13"><a class="header" href="#-frequently-asked-questions-13">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>Write these</li>
</ul>
<h3 id="grace-deploys-her-service-and-is-able-to-fix-problems"><a class="header" href="#grace-deploys-her-service-and-is-able-to-fix-problems">Grace deploys her service and is able to fix problems</a></h3>
<table><thead><tr><th>Character</th><th>Status quo</th><th>Assigned To</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#grace-the-principal-engineer-hacking-on-a-data-storage-service">Grace</a></td><td><a href="vision/./status_quo.html#grace-deploys-her-service-and-hits-obstacles">Grace deploys her service and hits obstacles</a></td><td>pnkfelix</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>Grace launches service</li>
<li>Hits a stalled task, debugs the problem</li>
<li>Customers complain about poor performance, she tracks it down</li>
</ul>
<h4 id="-frequently-asked-questions-14"><a class="header" href="#-frequently-asked-questions-14">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>Write these</li>
</ul>
<h3 id="grace-discovers-the-joy-of-generators"><a class="header" href="#grace-discovers-the-joy-of-generators">Grace discovers the joy of generators</a></h3>
<table><thead><tr><th>Character</th><th>Status quo</th><th>Assigned To</th></tr></thead><tbody>
<tr><td><a href="vision/./characters.html#grace-the-principal-engineer-hacking-on-a-data-storage-service">Grace</a></td><td><a href="vision/./status_quo.html#grace-tries-to-write-a-stream-and-pin-breaks-her-mind">Grace tries to write a stream and pin breaks her mind</a></td><td>‚úã <a href="vision/./how_to_vision_doc.html#how-can-i-finish-or-add-a-section-to-the-document">Volunteer wanted</a> ‚úã</td></tr>
</tbody></table>
<p>Outline:</p>
<ul>
<li>Grace uses generators and the code writes itself. It's ALMOST TOO EASY.</li>
</ul>
<h4 id="-frequently-asked-questions-15"><a class="header" href="#-frequently-asked-questions-15">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>Write these</li>
</ul>
<h1 id="-the-roadmap-what-were-doing-in-2021"><a class="header" href="#-the-roadmap-what-were-doing-in-2021">üìÖ The roadmap: what we're doing in 2021</a></h1>
<p>This page describes the current plans for 2021.
It is updated on a monthly basis.</p>
<h3 id="-not-time-for-this-yet--1"><a class="header" href="#-not-time-for-this-yet--1">üõë Not time for this yet üõë</a></h3>
<p>We're not really ready to work on this section yet. We're still focused on writing out the <a href="vision/./status_quo.html">status quo</a>. What you see here are really just placeholders to give you the idea of what this section might look like.</p>
<h2 id="key"><a class="header" href="#key">Key</a></h2>
<table><thead><tr><th>Emoji</th><th>Meaning</th></tr></thead><tbody>
<tr><td>ü•¨</td><td>&quot;Healthy&quot; -- on track with the plan as described in the doc</td></tr>
<tr><td>‚úèÔ∏è</td><td>&quot;Planning&quot; -- Still figuring out the plan</td></tr>
<tr><td>ü§í</td><td>&quot;Worried&quot; -- things are looking a bit tricky, plans aren't working out</td></tr>
<tr><td>üèñÔ∏è</td><td>&quot;On vacation&quot; -- taking a break right now</td></tr>
<tr><td>‚ö∞Ô∏è</td><td>We gave up on this idea =)</td></tr>
</tbody></table>
<h2 id="roadmap-items"><a class="header" href="#roadmap-items">Roadmap items</a></h2>
<table><thead><tr><th>Plan</th><th>Owner</th><th>Status</th><th>Last updated</th></tr></thead><tbody>
<tr><td><a href="vision/../design_docs/async_fn_in_traits.html">Async functions in traits</a></td><td>nikomatsakis</td><td>ü•¨</td><td>2021-02</td></tr>
</tbody></table>
<h1 id="-how-to-vision-doc"><a class="header" href="#-how-to-vision-doc">‚ùì How to vision doc</a></h1>
<h2 id="what-is-this-4"><a class="header" href="#what-is-this-4">What is this</a></h2>
<p>This page describes the process for contributing to the vision doc.</p>
<h3 id="-under-construction-help-needed--1"><a class="header" href="#-under-construction-help-needed--1">üöß Under construction! Help needed! üöß</a></h3>
<p>This document is not yet complete! We are actively working on it as part of the working group, and we would like your help! This page talks about what you can do to contribute.</p>
<h3 id="schedule-and-status"><a class="header" href="#schedule-and-status">Schedule and status</a></h3>
<p>We are currently working to complete a first draft of the <strong>status quo</strong> section. </p>
<h3 id="who-owns-this-document"><a class="header" href="#who-owns-this-document">Who owns this document?</a></h3>
<p>This document is owned and maintained by the leads of the Async Foundations Working Group.
They decide what content to accept or reject. 
This decision is made in consultation with the Rust teams that will be making the ultimate decisions. 
For example, if a design doc or part of the shiny future is describing a new language feature, the leads ought to discuss that with the language design team, since that team will ultimately have to approve the RFCs for its design.</p>
<h2 id="ways-to-help"><a class="header" href="#ways-to-help">Ways to help</a></h2>
<h3 id="use-async-rust-write-blog-posts-about-your-experiences"><a class="header" href="#use-async-rust-write-blog-posts-about-your-experiences">Use Async Rust? Write blog posts about your experiences!</a></h3>
<p>We want to make sure all Async Rust users and their experiences are reflected in the async vision doc, so please tell us your story! Share it in any form you want: blog posts, tweets, letters to the editor, whatever, as long as it has a URL. Be sure to include two things:</p>
<ul>
<li>Which of the [cast of characters][cc] fits you best? If none of them seem to fit you, then tell us what makes you different from them.</li>
<li>What are some of the challenges that you've encountered? Bonus points if you write in narrative style.</li>
</ul>
<p>After you write your post, let us know about it by submitting the URL using this [google form][gf]. Also, if you tweet about it, use the hashtag <code>#asyncvisiondoc</code>. If you want to read other people's stories, the URLs submitted via that form can be found [in this spreadsheet][gr].</p>
<h3 id="adding-or-adjusting-the-axes-or-set-of-characters"><a class="header" href="#adding-or-adjusting-the-axes-or-set-of-characters">Adding or adjusting the axes or set of characters</a></h3>
<p>Feel free to open PRs adjusting the values for the &quot;axes&quot; that cover the space of people using Async Rust, but keep in mind that we want this list to be relatively short and readable, so we may try to </p>
<p>Similarly, you can propose a new axis, but it's probably best to bring that up on Zulip first to discuss.</p>
<p>Finally, if you'd like to propose an adjustment to one of the characters or their background, please discuss it on Zulip first. At this point, those charactes are not yet &quot;fixed&quot; so changes to them are definitely in scope. Once we start to accumulate more stories, however, that will get harder!</p>
<p>When proposing a new character, make sure to include the following FAQs (and potentially others):</p>
<ul>
<li>How would you describe NAME in terms of the <a href="vision/./characters.html#axes">axes</a>?</li>
<li>What is most important to NAME about async Rust? Why?</li>
<li>What is least important to NAME about async Rust? Why?</li>
<li>What are key parts of NAME's background or story that distinguishes them from the other characters?</li>
</ul>
<h3 id="adding-or-adjusting-applications"><a class="header" href="#adding-or-adjusting-applications">Adding or adjusting applications</a></h3>
<p>We aim for the list of applications to be comprehensive. Feel free to open PRs that either add new applications or adjust the wording on 
existing ones. The [wg leads] may choose however not to add an application, or to generalize an existing category instead.</p>
<p>Make sure to include the following FAQs (and potentially others):</p>
<ul>
<li>What makes this application different from most others?</li>
<li>What are some examples of crates in this category?
<ul>
<li>We have to be careful with this, we don't want it to seem like we're picking favorites, but we also don't want the pressure to be comprehensive. Maybe we can link to crates.io tags or something?</li>
</ul>
</li>
</ul>
<h3 id="adding-or-adjusting-narratives-status-quo-shiny-future"><a class="header" href="#adding-or-adjusting-narratives-status-quo-shiny-future">Adding or adjusting narratives (status quo, shiny future)</a></h3>
<p>We are currently focused on filling out the &quot;status quo&quot; section. If you think you'd like to write a story there, feel free to come on Zulip and talk about it. You could either be completing one of the existing stories or creating a new one altogether.</p>
<p>When you write status quo stories, they are best supported by evidence. This may mean you want to add new <a href="vision/../conversations.html">conversations</a> at the same time, thogh sometimes we just link or describe the conversations in the FAQ.</p>
<p>The narratives in the two sections have different characteristics. Here is a summary:</p>
<ul>
<li><a href="vision/status_quo.html">Status quo</a> narrative
<ul>
<li><em>establishes:</em> problem framing</li>
<li><em>identifies:</em> root problems</li>
<li><em>provides:</em> supporting evidence for your theses</li>
<li><em>links to:</em> evidence, if you want to provide it</li>
<li><em>Frequently asked questions:</em> Include at least the following questions:
<ul>
<li>What are the morals of the story?</li>
<li>What are the sources for this story?</li>
<li>Why did you choose <em>NAME</em> to tell this story?</li>
<li>How would this story have played out differently for the other characters?</li>
</ul>
</li>
</ul>
</li>
<li><a href="vision/shiny_future.html">Shiny future</a> narrative
<ul>
<li><em>establishes:</em> north star</li>
<li><em>identifies:</em> key elements of the solution</li>
<li><em>provides:</em> a detailed description of how things should work for Rust's users down the road</li>
<li><em>links to:</em> design notes</li>
<li><em>Frequently asked questions:</em> Include at least the following questions:
<ul>
<li>What is <em>NAME</em> most excited about and why?</li>
<li>What is <em>NAME</em> most disappointed with?</li>
<li>Which other characters are helped by this?</li>
<li>Are any characters upset by this?</li>
<li>What do the other characters think about this?</li>
<li>What key things did the Rust org do to make this happen?</li>
<li>What things did the other groups do to make this happen?</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Whether it is status quo or shiny future, when you open the PR with your story, people will no doubt have many questions (e.g., why did Grace do X and not Y?). This may cause you to update your story; but if not, please update the FAQ for your story with the answer!</p>
<h4 id="-frequently-asked-questions-16"><a class="header" href="#-frequently-asked-questions-16">ü§î Frequently Asked Questions</a></h4>
<ul>
<li>What is the process to propose a status quo story?
<ul>
<li>You can write it and open a PR, but you can also just hop onto [Zulip] and let's talk about it!</li>
</ul>
</li>
<li>How should I describe the &quot;evidence&quot; for my status quo story?
<ul>
<li>The more specific you can get, the better. If you can link to tweets or blog posts, that's ideal. You can also add notes into the <a href="vision/../conversations.html">conversations</a> folder and link to those. Of course, you should be sure people are ok with that.</li>
</ul>
</li>
<li>What is the process to propose a shiny future story?
<ul>
<li>We are not yet accepting shiny future stories. We will announce the process soon!</li>
</ul>
</li>
<li>What if my story applies to multiple characters?
<ul>
<li>Look at the &quot;morals&quot; of your story and decide which character will let you get those across the best.</li>
<li>Use the FAQ to talk about how other characters might have been impacted.</li>
<li>If the story would play out really differently for other characters, maybe write it more than once!</li>
</ul>
</li>
<li>None of the characters are a fit for my story.
<ul>
<li>Uh oh! Come talk to us on [Zulip] about it!</li>
</ul>
</li>
</ul>
<h3 id="design-docs"><a class="header" href="#design-docs">Design docs</a></h3>
<p>We're still working out the process around design docs! Ask on Zulip.</p>
<p>Include at least the following FAQs:</p>
<ul>
<li>What assumptions are you using as the basis for this design?</li>
<li>Why not do ALTERNATIVE-X? (For each compelling alternative)</li>
<li>What design decisions cannot easily be reversed?</li>
</ul>
<h3 id="the-roadmap"><a class="header" href="#the-roadmap">The roadmap</a></h3>
<p>We're still working out the process around the roadmap! Ask on Zulip.</p>
<h1 id="-triage-meetings"><a class="header" href="#-triage-meetings">üîç Triage meetings</a></h1>
<h2 id="when-where"><a class="header" href="#when-where">When, where</a></h2>
<p>The weekly triage meeting is held on <a href="./welcome.html#zulip">Zulip</a> at 13:00 US Eastern time on Fridays (<a href="https://calendar.google.com/event?action=TEMPLATE&amp;tmeid=M2VhYjRjczZxanE5ODcwbzR1bnZsNTV0MGFfMjAyMTAyMjZUMTgwMDAwWiA2dTVycnRjZTZscnR2MDdwZmkzZGFtZ2p1c0Bn&amp;tmsrc=6u5rrtce6lrtv07pfi3damgjus%40group.calendar.google.com&amp;scp=ALL">google calendar event for meeting</a>).</p>
<h2 id="so-you-want-to-fix-a-bug"><a class="header" href="#so-you-want-to-fix-a-bug">So you want to fix a bug?</a></h2>
<p>If you're interested in fixing bugs, there is no need to wait for the triage meeting.
Take a look at the <a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3AE-mentor+label%3AA-async-await+no%3Aassignee">mentored async-await bugs that have no assignee</a>.
Every mentored bug should have a few comments.
If you see one you like, you can add the <code>@rustbot claim</code> comment into the bug and start working on it!
Feel to reach out to the mentor on <a href="./welcome.html#zulip">Zulip</a> to ask questions.</p>
<h2 id="project-board"><a class="header" href="#project-board">Project board</a></h2>
<p>The <a href="https://github.com/orgs/rust-lang/projects/2">project board</a> tracks various bugs and other work items for the async foundation group.
It is used to drive the triage process.</p>
<h2 id="triage-process"><a class="header" href="#triage-process">Triage process</a></h2>
<p>In our weekly triage meetings, we take new issues assigned <a href="https://github.com/rust-lang/rust/labels/A-async-await"><code>A-async-await</code></a> and categorize them. 
The process is:</p>
<ul>
<li>Review the <a href="https://github.com/orgs/rust-lang/projects/2">project board</a>, from right to left:
<ul>
<li>Look at what got <strong>Done</strong>, and celebrate! :tada:</li>
<li>Review <strong>In progress</strong> issues to check we are making progress and there is a clear path to finishing (otherwise, move to the appropriate column)</li>
<li>Review <strong>Blocked</strong> issues to see if there is anything we can do to unblock</li>
<li>Review <strong>Claimed</strong> issues to see if they are in progress, and if the assigned person still intends to work on it</li>
<li>Review <strong>To do</strong> issues and assign to anyone who wants to work on something</li>
</ul>
</li>
<li>Review <a href="https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AA-async-await+is%3Aopen+-label%3AAsyncAwait-Triaged&amp;type=Issues">uncategorized issues</a>
<ul>
<li>Mark <code>P-low</code>, <code>P-medium</code>, or <code>P-high</code></li>
<li>Add <code>P-high</code> and <em>assigned</em> <code>E-needs-mentor</code> issues to the <a href="https://github.com/orgs/rust-lang/projects/2">project board</a></li>
<li>Mark <code>AsyncAwait-triaged</code></li>
</ul>
</li>
<li>If there's still a shortage of <strong>To do</strong> issues, review the list of <a href="https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AAsyncAwait-Triaged+label%3AP-medium+is%3Aopen&amp;type=Issues"><code>P-medium</code></a> or <a href="https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AAsyncAwait-Triaged+label%3AP-low+is%3Aopen&amp;type=Issues"><code>P-low</code></a> issues for candidates</li>
</ul>
<h2 id="mentoring"><a class="header" href="#mentoring">Mentoring</a></h2>
<p>If an issue is a good candidate for mentoring, mark <code>E-needs-mentor</code> and try to find a mentor.</p>
<p>Mentors assigned to issues should write up mentoring instructions. 
<strong>Often, this is just a couple lines pointing to the relevant code.</strong> 
Mentorship doesn't require intimate knowledge of the compiler, just some familiarity and a willingness to look around for the right code.</p>
<p>After writing instructions, mentors should un-assign themselves, add <code>E-mentor</code>, and remove <code>E-needs-mentor</code>. 
On the project board, if a mentor is assigned to an issue, it should go to the <strong>Claimed</strong> column until mentoring instructions are provided. 
After that, it should go to <strong>To do</strong> until someone has volunteered to work on it.</p>
<h1 id="-design-documents"><a class="header" href="#-design-documents">üî¨ Design documents</a></h1>
<p>The <strong>design documents</strong> (or &quot;design docs&quot;, more commonly) describe potential designs. These docs vary greatly in terms of their readiness to be implemented:</p>
<ul>
<li>Early on, they describe a vague idea for a future. Often this takes the shape of capturing constraints on the solution, rather than the solution itself.</li>
<li>When a feature is getting ready to ship, they can evolve into a full blown RFC, with links to tracking issues or other notes.</li>
</ul>
<h2 id="early-stage-design-docs"><a class="header" href="#early-stage-design-docs">Early stage design docs</a></h2>
<p>In the early stages, design docs are meant to capture interesting bits of &quot;async design space&quot;. They are often updated to capture the results of a fruitful conversation or thread which uncovered contraints or challenges in solving a particular problem. They will capture a combination of the following:</p>
<ul>
<li>use cases;</li>
<li>interesting aspects to the design;</li>
<li>alternatives;</li>
<li>interactions with other features.</li>
</ul>
<h2 id="late-stage-design-docs"><a class="header" href="#late-stage-design-docs">Late stage design docs</a></h2>
<p>As a design progresses, the doc should get more and more complete, until it becomes something akin to an RFC. (Often, at that point, we will expand the design document into a directory, adding an actual RFC draft and other contents; those things can live in this repo or elsewhere, depending.) Once we decide to put a design doc onto the roadmap, it will also contain links to tracking issues or other places to track the status.</p>
<h1 id="-yield-safe-lint"><a class="header" href="#-yield-safe-lint">‚ö†Ô∏è Yield-safe lint</a></h1>
<h2 id="use-case"><a class="header" href="#use-case">Use-case</a></h2>
<p>Some types should not be held across a &quot;yield&quot; bound. A typical example is a <code>MutexGuard</code>:</p>
<pre><code class="language-rust ignore">async fn example(x: &amp;Lock&lt;u32&gt;) {
    let data = x.lock().unwrap();
    something().await;
    *data += 1;
}

async fn something() { }
</code></pre>
<p>In practice, a lot of these issues are avoided because <code>MutexGuard</code> is not <code>Send</code>, but single-thread runtimes hit these issues.</p>
<h2 id="types-where-this-would-apply"><a class="header" href="#types-where-this-would-apply">Types where this would apply</a></h2>
<ul>
<li><code>MutexGuard</code> for mutexes, read-write locks</li>
<li>Guards for ref-cells</li>
<li>Things that might use these types internally and wish to bubble it up</li>
</ul>
<h2 id="precedent-and-related-questions"><a class="header" href="#precedent-and-related-questions">Precedent and related questions</a></h2>
<ul>
<li>The <code>#[must_use]</code> lint on types, we would want their design to work very closely.</li>
<li>Non-async-friendly functions like <code>sleep</code> or <code>task::block_on</code>.</li>
</ul>
<h1 id="-stream-trait"><a class="header" href="#-stream-trait">‚òî Stream trait</a></h1>
<ul>
<li><a href="https://docs.rs/futures/0.3/futures/stream/trait.Stream.html">Current definition</a></li>
</ul>
<h2 id="trait-definition"><a class="header" href="#trait-definition">Trait definition</a></h2>
<pre><code class="language-rust ignore">pub trait Stream {
    type Item;

    fn poll_next(
        self: Pin&lt;&amp;mut Self&gt;,
        cx: &amp;mut Context&lt;'_&gt;,
    ) -&gt; Poll&lt;Option&lt;Self::Item&gt;&gt;;

    #[inline]
    fn size_hint(&amp;self) -&gt; (usize, Option&lt;usize&gt;) {
        (0, None)
    }
}
</code></pre>
<h2 id="concerns"><a class="header" href="#concerns">Concerns</a></h2>
<h3 id="poll-based-design"><a class="header" href="#poll-based-design">Poll-based design</a></h3>
<ul>
<li>You have to think about Pin if you implement this trait.</li>
<li>Combinators can be more difficult.</li>
<li>One solution: <a href="design_docs/./generator_syntax.html">generator syntax</a>.</li>
</ul>
<h3 id="attached-streams-are-commonly-desired"><a class="header" href="#attached-streams-are-commonly-desired">Attached streams are commonly desired</a></h3>
<p>Sometimes streams need to reuse internal storage (<a href="http://smallcultfollowing.com/babysteps/blog/2019/12/10/async-interview-2-cramertj-part-2/#the-need-for-streaming-streams-and-iterators">Discussion</a>).</p>
<h3 id="combinators"><a class="header" href="#combinators">Combinators</a></h3>
<ul>
<li>Currently the combinations are stored in the <a href="https://docs.rs/futures/0.3/futures/stream/trait.StreamExt.html"><code>StreamExt</code></a> module.</li>
<li>In some cases, this is because of the lack of async closures support.
<ul>
<li>Also serves as a &quot;semver barrier&quot;.</li>
<li>Also no-std compatibility.</li>
</ul>
</li>
<li>One question: what combinators (if any) to include when stabilizing?
<ul>
<li>e.g., <a href="https://docs.rs/futures/0.3/futures/stream/trait.StreamExt.html#method.poll_next_unpin"><code>poll_next_unpin</code></a> can make working with pin easier, albeit at a loss of generality
<ul>
<li>folks who are new to pinning could use this method, and it can help us to guide the diagnostics by suggesting that they <code>Box::pin</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="--generator-syntax"><a class="header" href="#--generator-syntax">‚ö°  Generator syntax</a></h1>
<ul>
<li>It would be useful to be able to write a function to return an iterator or (in the async context) a generator</li>
<li>The basic shape might be (modulo bikeshedding) <code>gen fn</code> that contains <code>yield</code></li>
<li>Some question marks:
<ul>
<li>How general of a mechanism do we want?
<ul>
<li>Just target iterators and streams, or shoot for something more general?</li>
</ul>
</li>
</ul>
</li>
<li>Some of the question marks that arise if you go beyond iterators and streams:
<ul>
<li>Return values that are not unit</li>
<li>Have yield return a value that is passed by the caller of <code>next</code> (&quot;resume args&quot;)</li>
</ul>
</li>
</ul>
<h1 id="-asyncread-asyncwrite-traits"><a class="header" href="#-asyncread-asyncwrite-traits">üìù AsyncRead, AsyncWrite traits</a></h1>
<h1 id="-async-fn-in-traits"><a class="header" href="#-async-fn-in-traits">üß¨ Async fn in traits</a></h1>
<ul>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2019/10/26/async-fn-in-traits-are-hard/">Why async fn in traits are hard</a></li>
</ul>
<h2 id="general-goal"><a class="header" href="#general-goal">General goal</a></h2>
<pre><code class="language-rust ignore">trait Foo {
    // Currently disallowed:
    async fn bar();
}
</code></pre>
<h2 id="concerns-1"><a class="header" href="#concerns-1">Concerns</a></h2>
<h3 id="how-to-name-the-resulting-future"><a class="header" href="#how-to-name-the-resulting-future">How to name the resulting future</a></h3>
<p>If you wanted to name the future that results from calling <code>bar</code> (or whatever), you can't.</p>
<p>Also true for functions <code>fn bar() -&gt; impl Trait</code>.</p>
<h3 id="requiring-send-on-futures"><a class="header" href="#requiring-send-on-futures">Requiring <code>Send</code> on futures</a></h3>
<p><a href="https://internals.rust-lang.org/t/how-often-do-you-want-non-send-futures/10360">Relevant thread</a></p>
<pre><code class="language-rust ignore">async fn foo() {}

// desugars to
fn foo() -&gt; impl Future&lt;Output = ()&gt; { } // resulting type is Send if it can be

// alternative desugaring we chose not to adopt would require Send
fn foo() -&gt; impl Future + Send { }
</code></pre>
<p>If I want to constrain the future I get back from a method, it is difficult to do without a name:</p>
<pre><code class="language-rust ignore">trait Service {
    async fn request(&amp;self);
}

fn parallel_service&lt;S: Service&gt;()
where
    S::Future: Send,
{
    ...
}
</code></pre>
<ul>
<li>Should this be solved at the impl trait layer</li>
<li>Or should we specialize something for async functions</li>
<li>Would be nice, if there are many, associated types, to have some shorthand</li>
</ul>
<h2 id="example-use-case-the-service"><a class="header" href="#example-use-case-the-service">Example use case: the Service</a></h2>
<pre><code class="language-rust ignore">trait Service {
    type Future: Future&lt;Output = Response&gt;;

    fn request(&amp;self, ...) -&gt; Self::Future;
}

impl Service for MyService {
    type Future = impl Future&lt;Output = Response&gt;;

    fn request(&amp;self) -&gt; Self::Future {
        async move { .. }
    }
}
</code></pre>
<ul>
<li>Dependent on impl Trait, see lang-team repo</li>
</ul>
<h2 id="example-use-case-capturing-lifetimes-of-arguments"><a class="header" href="#example-use-case-capturing-lifetimes-of-arguments">Example use case: capturing lifetimes of arguments</a></h2>
<pre><code class="language-rust ignore">trait MyMethod {
    async fn foo(&amp;self);
}
</code></pre>
<h2 id="-frequently-asked-questions-17"><a class="header" href="#-frequently-asked-questions-17">ü§î Frequently Asked Questions</a></h2>
<ul>
<li><strong>What do people say about this to their friends on twitter?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
</ul>
<h1 id="-mutex-future-aware"><a class="header" href="#-mutex-future-aware">üîí Mutex (future-aware)</a></h1>
<p><a href="https://github.com/Diggsey/posts/tree/master/async-mutexes">Description of various challenges with async mutexes</a></p>
<h1 id="-async-aware-channels"><a class="header" href="#-async-aware-channels">üì∫ Async aware channels</a></h1>
<h1 id="-async-closures"><a class="header" href="#-async-closures">üì¶ Async closures</a></h1>
<h1 id="-join-combinator"><a class="header" href="#-join-combinator">ü§ù Join combinator</a></h1>
<h1 id="-select-combinator"><a class="header" href="#-select-combinator">ü§∑‚Äç‚ôÄÔ∏è Select combinator</a></h1>
<h1 id="-sink-trait"><a class="header" href="#-sink-trait">üö∞ Sink trait</a></h1>
<h1 id="-async-main"><a class="header" href="#-async-main">üéá Async main</a></h1>
<h2 id="what-is-it"><a class="header" href="#what-is-it">What is it?</a></h2>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<h2 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h2>
<h1 id="-async-drop"><a class="header" href="#-async-drop">üóëÔ∏è Async drop</a></h1>
<h1 id="-async-lifecycle"><a class="header" href="#-async-lifecycle">‚ôªÔ∏è Async lifecycle</a></h1>
<h1 id="-completion-based-futures"><a class="header" href="#-completion-based-futures">‚è≥ Completion-based futures</a></h1>
<p><a href="https://boats.gitlab.io/blog/post/io-uring">Notes on io_uring</a></p>
<h1 id="-conversations"><a class="header" href="#-conversations">üí¨ Conversations</a></h1>
<p>This section contains notes and summaries from conversations that we have had with people are using Rust and async and describing their experiences. These conversations and links are used as &quot;evidence&quot; when building <a href="vision/status_quo.html">the &quot;status quo&quot; section</a>.</p>
<h2 id="not-exhaustive-nor-mandatory"><a class="header" href="#not-exhaustive-nor-mandatory">Not exhaustive nor mandatory</a></h2>
<p>This section is not meant to be an &quot;exhaustive list&quot; of all sources. That would be impossible. Many conversations are short, not recorded, and hard to summaize. Others are subject to NDA. We certainly don't require that all claims in the <a href="vision/status_quo.html">status quo</a> section are backed by evidence found here. Still, it's useful to have a place to dump notes and things for future reference.</p>
<h1 id="-2021-02-12-twitter-thread"><a class="header" href="#-2021-02-12-twitter-thread">üê¶ 2021-02-12 Twitter thread</a></h1>
<p>Notes taken from the thread in response to <a href="https://twitter.com/nikomatsakis/status/1359454255971770372">Niko's tweet</a>.</p>
<ul>
<li><a href="https://twitter.com/enzo_mdd/status/1359544617121820676">Enzo</a>
<ul>
<li>A default event loop. &quot;choosing your own event loop&quot; takes time, then you have to understand the differences between each event loop etc.</li>
<li>Standard way of doing <code>for await (variable of iterable)</code> would be nice.</li>
<li>Standard promise combinators.</li>
</ul>
</li>
<li><a href="https://twitter.com/creepy_owlet/status/1359649695103131649">creepy_owlet</a>
<ul>
<li>https://github.com/dtantsur/rust-osauth/blob/master/src/sync.rs</li>
</ul>
</li>
<li>async trait --
<ul>
<li>https://twitter.com/jcsp_tweets/status/1359820431151267843</li>
<li>&quot;I thought async was built-in&quot;?</li>
<li>nasty compiler errors</li>
<li><a href="https://www.fpcomplete.com/blog/ownership-puzzle-rust-async-hyper/">ownership puzzle</a> blog post</li>
</ul>
</li>
<li><a href="https://twitter.com/rubdos/status/1359462402702606336">rubdos</a>
<ul>
<li><a href="https://www.rubdos.be/corona/qt/rust/tokio/actix/2020/05/23/actix-qt.html">blog post</a> describes integrating two event loops</li>
<li>mentions desire for runtime independent libraries</li>
<li>qt provides a mechanism to integrate one's own event loop</li>
<li><a href="https://github.com/rust-lang/rust/issues/60605">llvm bug</a> generates invalid arm7 assembly</li>
</ul>
</li>
<li><a href="https://twitter.com/alexmiberry/status/1359559299161325581">alexmiberry</a>
<ul>
<li>kotlin/scala code, blocked by absence of async trait</li>
</ul>
</li>
<li>helpful blog post
<ul>
<li><a href="http://jamesmcm.github.io/blog/2020/05/06/a-practical-introduction-to-async-programming-in-rust/">jamesmcm</a>
<ul>
<li>note that <code>join</code> and <code>Result</code> play poorly together
<ul>
<li><a href="https://github.com/jamesmcm/async-rust-example/blob/async-std/client_async/src/main.rs#L50-L59">async-std version</a></li>
<li><a href="https://github.com/jamesmcm/async-rust-example/blob/master/client_async/src/main.rs#L40-L61">tokio version</a> has some wild &quot;double question marks&quot; -- I guess that spawn must be adding a layer of <code>Result</code>?</li>
</ul>
</li>
</ul>
</li>
<li>the post mentions rayon but this isn't really a case where one ought to use rayon -- still, Rayon's APIs here are SO much nicer :)</li>
<li><a href="http://jamesmcm.github.io/blog/2020/04/19/data-engineering-with-rust-and-aws-lambda/#en">rust aws and lambda</a></li>
</ul>
</li>
<li><a href="https://github.com/jamesmcm/s3rename/issues/16">issue requiring async drop</a></li>
<li><a href="https://fasterthanli.me/articles/getting-in-and-out-of-trouble-with-rust-futures">fasterthanlime</a> -- 
<ul>
<li>this post is amazing</li>
<li>the discussion on Send bounds and the ways to debug it is great</li>
</ul>
</li>
<li><a href="https://github.com/thanethomson/async-channel-abs/blob/master/src/runtime.rs">bridging different runtimes using GATs</a></li>
<li>first server app, <a href="https://twitter.com/richardsabow/status/1345815109201842178">great thread with problems</a>
<ul>
<li>&quot;I wasn't expecting that it will be easy but after Go and Node.js development it felt extremely hard to start off anything with Rust.&quot;</li>
<li>&quot;felt like I have to re-learn everything from scratch: structuring project and modules, dependency injection, managing the DB and of course dealing with concurrency&quot;</li>
<li>common thread: poor docs, though only somewhat in async libraries
<ul>
<li>I had enums in the DB and it was a bit more complex to map them to my custom Rust enums but I succeeded with the help of a couple of blog posts ‚Äì and not with Diesel documentation</li>
<li>I used Rusoto for dealing with AWS services. It's also pretty straightforward and high quality package ‚Äì but again the documentation was sooo poor. </li>
</ul>
</li>
</ul>
</li>
<li><a href="https://t.co/4rlyfUlFES?amp=1">implaustin</a> wrote a <a href="https://t.co/4rlyfUlFES?amp=1">very nice post</a> but it felt more like a &quot;look how well this worked&quot; post than one with actionable feedback
<ul>
<li>&quot;Async has worked well so far.  My top wishlist items are Sink and Stream traits in std.  It's quite difficult to abstract over types that asynchronously produce or consume values.&quot;</li>
<li>&quot;AsyncRead/AsyncWrite work fine for files, tcp streams, etc.  But once you are past I/O and want to pass around structs, Sink and Stream are needed.  One example of fragmentation is that Tokio channels used to implement the futures Sink/Stream traits, but no longer do in 1.0.&quot;</li>
<li>&quot;I usually use Sink/Stream to abstract over different async channel types.  Sometimes to hide the details of external dependencies from a task (e.g. where is this data going?).  And sometimes to write common utility methods.&quot;</li>
<li>&quot;One thing I can think of: there are still a lot of popular libraries that don't have async support (or are just getting there).  Rocket, Criterion, Crossterm's execute, etc.&quot;</li>
</ul>
</li>
<li><a href="https://twitter.com/EchoRior/status/1359964691305496579">EchoRior</a>:
<ul>
<li>&quot;I've written a bit of rust before, but rust is my first introduction to Async. My main gripes are that it's hard to figure our what the &quot;blessed&quot; way of doing async is. I'd love to see async included in the book, but I understand that async is still evolving too much for that.&quot;</li>
<li>&quot;Adding to the confusion: theres multiple executors, and they have a bit of lock in. Async libraries being dependent on which executor version I use is also confusing for newcomers. In other langs, it seems like one just uses everything from the stdlib and everything is compatible&quot;</li>
<li>&quot;That kind of gave me a lot of hesitation/fomo in the beginning, because it felt like I had to make some big choices around my tech stack that I felt I would be stuck with later. I ended up chatting about this in the discord &amp; researching for multiple days before getting started.&quot;</li>
<li>&quot;Also, due to there not being a &quot;blessed&quot; approach, I don't know if I'm working with some misconceptions around async in rust, and will end up discovering I will need to redo large parts of what I wrote.&quot;</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
